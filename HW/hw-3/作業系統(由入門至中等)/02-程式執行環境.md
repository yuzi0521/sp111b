# 第二章：程式執行環境

## 2.1 程式的執行方式

在計算機中，程式是由CPU執行的，CPU需要將程式讀入內存，解析指令並執行。程式的執行可以分為以下幾個步驟：

1. 編譯：程式設計師通常使用高級編程語言來編寫程式，如C++、Java等。編程語言的代碼需要被轉換為機器語言，以便CPU能夠理解和執行。這個轉換的過程稱為編譯，其產生的可執行檔包含了CPU可以直接執行的機器語言代碼。

2. 裝載：可執行檔被裝載進入內存，這個過程由作業系統負責。作業系統將可執行檔裝載到內存的某個位置，並為其分配必要的資源，如堆棧和堆。當執行可執行檔時，CPU會讀取內存中的指令並執行它們。

3. 執行：當可執行檔被裝載到內存並分配了必要的資源後，CPU可以開始執行程式。CPU從內存中讀取指令，解析並執行。執行過程中，CPU還需要和其他系統組件（如硬盤、輸入設備等）進行通訊，以便程序能夠與外界進行交互。

4. 結束：當程序執行完畢或者遇到錯誤時，程序需要被結束。作業系統需要將程序佔用的資源（如內存）釋放，以便其他程序可以使用這些資源。在一些情況下，程序可能會被強制終止，如出現致命錯誤或用戶手動終止程序。

程式的執行方式是作業系統中的一個基本概念，對於深入理解作業系統的工作原理至關重要。在後續章節中，我們將更加詳細地探討這個問題。

## 2.2 虛擬記憶體的概念

虛擬記憶體是一種允許程序使用比實際內存體積更大的記憶體空間的技術。在虛擬記憶體中，程序可以使用虛擬地址空間，這個虛擬地址空間會被映射到實際的物理內存或磁盤上，由作業系統負責管理。使用虛擬記憶體技術，可以使得程序看起來似乎是在使用比實際內存體積更大的記憶體空間，但是實際上，程序只會在需要時才會將所需內容從虛擬記憶體中載入到實際的內存或磁盤中，以減少實際內存的使用量，從而提高系統的整體性能。

虛擬記憶體由虛擬地址空間和虛擬內存組成。虛擬地址空間是由程序可用的內存地址范圍所組成的抽象概念，它通常比實際的內存空間大得多。虛擬內存是指作業系統使用磁盤空間來模擬內存，並且通過頁式記憶管理機制，將虛擬地址空間划分為多個大小相等的頁（或稱為區段或段），每個頁可以單獨載入到內存中，以實現虛擬內存的管理。

使用虛擬記憶體技術，可以實現多道程序並發運行。當多個程序需要同時運行時，每個程序會被分配一個虛擬地址空間，這個虛擬地址空間是獨立的，每個程序都可以使用自己的虛擬地址空間，而不會互相干擾。作業系統負責將虛擬地址轉換為實際的物理地址，以實現程序的運行。此外，虛擬記憶體技術還可以實現內存保護、共享內存、內存壓縮等功能，從而提高系統的穩定性和性能。